---
title: "Religion vs corruption dataset"
author: "Marina Ramírez Baños, Giovanni Vincenzo Cavallo, Pablo Bondia Portoles, Priyanka"
date: "2024-11-05"
output: html_document
---

# Import data

First, lets load the packages needed and import both data sets.

```{r}
# Load tidyverse and readr packages

library(tidyverse)
library(readr)

# Import religion_by_country and corruption_by_country datasets

religion_by_country <- read_csv("religion-by-country-2024.csv")

corruption_by_country <- read_delim("CPI2020.csv", delim = ";", escape_double = FALSE, trim_ws = TRUE, skip = 2)

```

Second, we are going to filter religion_by_country dataset to include only the data from 2020.

```{r}

dput(names(religion_by_country))


# Filter religion_by_country dataset only including the data from 2020

religion_by_country <- religion_by_country %>% select("country", "ReligionByCountry_TotalReligious_2020",  "religionByCountry_christians_2020", 
"religionByCountry_muslims_2020", "religionByCountry_hindus_2020", 
"religionByCountry_buddhists_2020", "religionByCountry_folkReligions_2020", 
"religionByCountry_jews_2020", "religionByCountry_other_2020", 
"religionByCountry_unaffiliated_2020", "total")



```

# Merging datasets

To merge both datasets we have to use a variable they have in common. In our case, that variable is "country". However, we firstly need to rename "Country" in the corruption_by_country dataset to "country", as it is in the religion_by_country dataset.

```{r}
# Rename "Country" to "country" from corruption_by_country dataset

corruption_by_country <- corruption_by_country %>% rename(country = Country)

# Use full_join() from tidyverse to merge the datasets by country. By doing that, if a country is included in the dataset 1 but not in dataset 2, the columms of dataset 2 will contain "NA" values for that rows and viceversa

merged_dataset <- full_join(religion_by_country, corruption_by_country, by = "country")

```

# Tidy data

For the purpose of the analysis, we want to exclude those countries that do not show data about the amount of religious population in 2020 or have a NA value for CPI score 2020.

```{r}
# Remove from merged_dataset those countries with NA values for ReligionByCountry_TotalReligious_2020

merged_dataset <- merged_dataset %>% filter(!is.na(ReligionByCountry_TotalReligious_2020))

# Remove from merged_dataset those countries with NA values for CPI score 2020

merged_dataset <- merged_dataset %>% filter(!is.na(`CPI score 2020`))

```



We want the merged dataset to have no NAs and to include the percentage of people affiliated with a religion


```{r}
tidy_dataset<-merged_dataset %>% 
  mutate(percentage_religious = (ReligionByCountry_TotalReligious_2020/ total) * 100) %>% 
  select(country,percentage_religious)

```



Assumptions for check for correlation analysis:

1. Linearity check: Pearson’s correlation measures only linear relationships. If the relationship is non-linear (e.g., quadratic or logarithmic), Pearson’s correlation may underestimate or misrepresent the true relationship.

2. 1.3. Homoscedasticity (Equal Variances):  If the variability of one variable increases as the other variable increases (called heteroscedasticity), Pearson’s correlation may not be valid, leading to incorrect conclusions about the strength of the relationship.



```{r}
# Load ggplot2 library
library(ggplot2)

# Example: Scatterplot to check linearity
ggplot(religion_by_country, aes(x = age_of_marriage, y = percentage_affiliated)) +
  geom_point() +                          # Plot the data points
  geom_smooth(method = "lm", se = FALSE, col = "red") +  # Add a linear regression line
  labs(title = "Scatterplot: Age of Marriage vs % Affiliated",
       x = "Age of Marriage", y = "% Affiliated") +
  theme_minimal()


```

2. Normality of variables: Pearson’s correlation assumes that the data comes from normal distributions, so violations of normality can affect the p-value and the confidence interval of the correlation coefficient, making the test less reliable. 

If it is not normal we would still do the analysis as the sample size (number of countries) is quite large so under the CLT we can make the anlaysis.

```{r}

```

